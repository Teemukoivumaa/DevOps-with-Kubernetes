teemu@teemu-ideapad:~$  kubectl apply -k github.com/fluxcd/flagger/kustomize/linkerd
customresourcedefinition.apiextensions.k8s.io/alertproviders.flagger.app unchanged
customresourcedefinition.apiextensions.k8s.io/canaries.flagger.app unchanged
customresourcedefinition.apiextensions.k8s.io/metrictemplates.flagger.app unchanged
serviceaccount/flagger unchanged
clusterrole.rbac.authorization.k8s.io/flagger unchanged
clusterrolebinding.rbac.authorization.k8s.io/flagger unchanged
deployment.apps/flagger configured

teemu@teemu-ideapad:~$  kubectl -n linkerd rollout status deploy/flagger
deployment "flagger" successfully rolled out

teemu@teemu-ideapad:~$  kubectl create ns test && \
>   kubectl apply -f https://run.linkerd.io/flagger.yml
namespace/test created
deployment.apps/load created
configmap/frontend created
deployment.apps/frontend created
service/frontend created
deployment.apps/podinfo created
service/podinfo created

teemu@teemu-ideapad:~$ $ kubectl -n test rollout status deploy podinfo
Waiting for deployment "podinfo" rollout to finish: 0 of 1 updated replicas are available...
deployment "podinfo" successfully rolled out

teemu@teemu-ideapad:~$  kubectl -n test port-forward svc/frontend 8080
Forwarding from 127.0.0.1:8080 -> 8080
Forwarding from [::1]:8080 -> 8080

teemu@teemu-ideapad:~$  cat <<EOF | kubectl apply -f -
> apiVersion: flagger.app/v1beta1
> kind: Canary
> metadata:
>   name: podinfo
>   namespace: test
> spec:
>   targetRef:
>     apiVersion: apps/v1
>     kind: Deployment
>     name: podinfo
>   service:
>     port: 9898
>   analysis:
>     interval: 10s
>     threshold: 5
>     stepWeight: 10
>     maxWeight: 100
>     metrics:
>     - name: request-success-rate
>       thresholdRange:
>         min: 99
>       interval: 1m
>     - name: request-duration
>       thresholdRange:
>         max: 500
>       interval: 1m
> EOF
canary.flagger.app/podinfo created

teemu@teemu-ideapad:~$  kubectl -n test get ev --watch
LAST SEEN   TYPE      REASON                  OBJECT                                  MESSAGE
3m20s       Normal    ScalingReplicaSet       deployment/load                         Scaled up replica set load-7f97579865 to 1
3m20s       Normal    SuccessfulCreate        replicaset/load-7f97579865              Created pod: load-7f97579865-mzdxd
3m20s       Normal    Injected                deployment/load                         Linkerd sidecar proxy injected
3m19s       Normal    Scheduled               pod/load-7f97579865-mzdxd               Successfully assigned test/load-7f97579865-mzdxd to k3d-k3s-default-agent-0
3m18s       Normal    ScalingReplicaSet       deployment/frontend                     Scaled up replica set frontend-6957977dc7 to 1
3m18s       Normal    Injected                deployment/frontend                     Linkerd sidecar proxy injected
3m18s       Normal    SuccessfulCreate        replicaset/frontend-6957977dc7          Created pod: frontend-6957977dc7-z8d4l
3m18s       Normal    ScalingReplicaSet       deployment/podinfo                      Scaled up replica set podinfo-7bfd46f477 to 1
3m18s       Normal    Scheduled               pod/frontend-6957977dc7-z8d4l           Successfully assigned test/frontend-6957977dc7-z8d4l to k3d-k3s-default-server-0
3m18s       Normal    Injected                deployment/podinfo                      Linkerd sidecar proxy injected
3m18s       Normal    SuccessfulCreate        replicaset/podinfo-7bfd46f477           Created pod: podinfo-7bfd46f477-q5pp9
3m17s       Normal    Scheduled               pod/podinfo-7bfd46f477-q5pp9            Successfully assigned test/podinfo-7bfd46f477-q5pp9 to k3d-k3s-default-agent-0
3m18s       Normal    Pulled                  pod/load-7f97579865-mzdxd               Container image "cr.l5d.io/linkerd/proxy-init:v1.5.3" already present on machine
3m16s       Normal    Pulled                  pod/frontend-6957977dc7-z8d4l           Container image "cr.l5d.io/linkerd/proxy-init:v1.5.3" already present on machine
3m16s       Normal    Pulled                  pod/podinfo-7bfd46f477-q5pp9            Container image "cr.l5d.io/linkerd/proxy-init:v1.5.3" already present on machine
3m16s       Normal    Created                 pod/load-7f97579865-mzdxd               Created container linkerd-init
3m16s       Normal    Started                 pod/load-7f97579865-mzdxd               Started container linkerd-init
3m15s       Normal    Pulled                  pod/load-7f97579865-mzdxd               Container image "cr.l5d.io/linkerd/proxy:stable-2.11.4" already present on machine
3m15s       Normal    Created                 pod/frontend-6957977dc7-z8d4l           Created container linkerd-init
3m15s       Normal    Created                 pod/podinfo-7bfd46f477-q5pp9            Created container linkerd-init
3m14s       Normal    Started                 pod/podinfo-7bfd46f477-q5pp9            Started container linkerd-init
3m14s       Normal    Started                 pod/frontend-6957977dc7-z8d4l           Started container linkerd-init
3m14s       Normal    Pulled                  pod/frontend-6957977dc7-z8d4l           Container image "cr.l5d.io/linkerd/proxy:stable-2.11.4" already present on machine
3m14s       Normal    Pulled                  pod/podinfo-7bfd46f477-q5pp9            Container image "cr.l5d.io/linkerd/proxy:stable-2.11.4" already present on machine
3m14s       Normal    Created                 pod/load-7f97579865-mzdxd               Created container linkerd-proxy
3m13s       Normal    IssuedLeafCertificate   serviceaccount/default                  issued certificate for default.test.serviceaccount.identity.linkerd.cluster.local until 2022-08-01 17:48:20 +0000 UTC: c5614f421dc7c674bcc1e6170fb7085b
3m13s       Normal    Started                 pod/load-7f97579865-mzdxd               Started container linkerd-proxy
3m13s       Normal    Pulling                 pod/load-7f97579865-mzdxd               Pulling image "buoyantio/slow_cooker:1.2.0"
3m12s       Normal    Created                 pod/frontend-6957977dc7-z8d4l           Created container linkerd-proxy
3m12s       Normal    Created                 pod/podinfo-7bfd46f477-q5pp9            Created container linkerd-proxy
3m12s       Normal    IssuedLeafCertificate   serviceaccount/default                  issued certificate for default.test.serviceaccount.identity.linkerd.cluster.local until 2022-08-01 17:48:21 +0000 UTC: 81e30c1c83add8b34f8b1092cb78c4a1
3m12s       Normal    IssuedLeafCertificate   serviceaccount/default                  issued certificate for default.test.serviceaccount.identity.linkerd.cluster.local until 2022-08-01 17:48:21 +0000 UTC: 28326288adb5d8e029cfbb70305e0938
3m12s       Normal    Started                 pod/frontend-6957977dc7-z8d4l           Started container linkerd-proxy
3m12s       Normal    Pulling                 pod/frontend-6957977dc7-z8d4l           Pulling image "nginx:alpine"
3m12s       Normal    Started                 pod/podinfo-7bfd46f477-q5pp9            Started container linkerd-proxy
3m12s       Normal    Pulling                 pod/podinfo-7bfd46f477-q5pp9            Pulling image "quay.io/stefanprodan/podinfo:1.7.0"
2m50s       Normal    Pulled                  pod/load-7f97579865-mzdxd               Successfully pulled image "buoyantio/slow_cooker:1.2.0" in 23.54068339s
2m46s       Normal    Pulled                  pod/podinfo-7bfd46f477-q5pp9            Successfully pulled image "quay.io/stefanprodan/podinfo:1.7.0" in 25.482798s
2m45s       Normal    Pulled                  pod/frontend-6957977dc7-z8d4l           Successfully pulled image "nginx:alpine" in 26.925333832s
2m26s       Normal    Created                 pod/frontend-6957977dc7-z8d4l           Created container nginx
2m26s       Normal    Created                 pod/podinfo-7bfd46f477-q5pp9            Created container podinfod
2m26s       Normal    Created                 pod/load-7f97579865-mzdxd               Created container slow-cooker
2m26s       Normal    Started                 pod/frontend-6957977dc7-z8d4l           Started container nginx
2m26s       Normal    Started                 pod/podinfo-7bfd46f477-q5pp9            Started container podinfod
2m26s       Normal    Started                 pod/load-7f97579865-mzdxd               Started container slow-cooker
86s         Warning   Synced                  canary/podinfo                          podinfo-primary.test not ready: waiting for rollout to finish: observed deployment generation less than desired generation
86s         Normal    ScalingReplicaSet       deployment/podinfo-primary              Scaled up replica set podinfo-primary-5cb494c64c to 1
86s         Normal    Injected                deployment/podinfo-primary              Linkerd sidecar proxy injected
86s         Normal    SuccessfulCreate        replicaset/podinfo-primary-5cb494c64c   Created pod: podinfo-primary-5cb494c64c-pnlv5
85s         Normal    Scheduled               pod/podinfo-primary-5cb494c64c-pnlv5    Successfully assigned test/podinfo-primary-5cb494c64c-pnlv5 to k3d-k3s-default-agent-1
84s         Normal    Pulled                  pod/podinfo-primary-5cb494c64c-pnlv5    Container image "cr.l5d.io/linkerd/proxy-init:v1.5.3" already present on machine
82s         Normal    Created                 pod/podinfo-primary-5cb494c64c-pnlv5    Created container linkerd-init
82s         Normal    Started                 pod/podinfo-primary-5cb494c64c-pnlv5    Started container linkerd-init
80s         Normal    Pulled                  pod/podinfo-primary-5cb494c64c-pnlv5    Container image "cr.l5d.io/linkerd/proxy:stable-2.11.4" already present on machine
79s         Normal    Created                 pod/podinfo-primary-5cb494c64c-pnlv5    Created container linkerd-proxy
79s         Normal    IssuedLeafCertificate   serviceaccount/default                  issued certificate for default.test.serviceaccount.identity.linkerd.cluster.local until 2022-08-01 17:50:14 +0000 UTC: eb34aca444e33c0fabbdccf90be7ad07
79s         Normal    Started                 pod/podinfo-primary-5cb494c64c-pnlv5    Started container linkerd-proxy
78s         Normal    Pulling                 pod/podinfo-primary-5cb494c64c-pnlv5    Pulling image "quay.io/stefanprodan/podinfo:1.7.0"
66s         Warning   Synced                  canary/podinfo                          podinfo-primary.test not ready: waiting for rollout to finish: 0 of 1 (readyThreshold 100%) updated replicas are available
63s         Normal    Pulled                  pod/podinfo-primary-5cb494c64c-pnlv5    Successfully pulled image "quay.io/stefanprodan/podinfo:1.7.0" in 15.460599449s
59s         Normal    Created                 pod/podinfo-primary-5cb494c64c-pnlv5    Created container podinfod
58s         Normal    Started                 pod/podinfo-primary-5cb494c64c-pnlv5    Started container podinfod
56s         Warning   Synced                  canary/podinfo                          Error checking metric providers: prometheus not avaiable: running query failed: request failed: Get "http://prometheus.linkerd-viz:9090/api/v1/query?query=vector%281%29": dial tcp: lookup prometheus.linkerd-viz on 10.43.0.10:53: no such host
56s         Normal    ScalingReplicaSet       deployment/podinfo                      Scaled down replica set podinfo-7bfd46f477 to 0
56s         Normal    SuccessfulDelete        replicaset/podinfo-7bfd46f477           Deleted pod: podinfo-7bfd46f477-q5pp9
56s         Normal    Killing                 pod/podinfo-7bfd46f477-q5pp9            Stopping container linkerd-proxy
56s         Normal    Killing                 pod/podinfo-7bfd46f477-q5pp9            Stopping container podinfod
56s         Normal    Synced                  canary/podinfo                          Initialization done! podinfo.test

teemu@teemu-ideapad:~$  kubectl -n test get svc
NAME              TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
frontend          ClusterIP   10.43.156.41    <none>        8080/TCP   3m46s
podinfo-canary    ClusterIP   10.43.218.112   <none>        9898/TCP   114s
podinfo-primary   ClusterIP   10.43.127.128   <none>        9898/TCP   114s
podinfo           ClusterIP   10.43.168.8     <none>        9898/TCP   3m46s

teemu@teemu-ideapad:~$  kubectl -n test set image deployment/podinfo \
>   podinfod=quay.io/stefanprodan/podinfo:1.7.1
deployment.apps/podinfo image updated

teemu@teemu-ideapad:~$ kubectl -n test get ev --watch
LAST SEEN   TYPE      REASON                  OBJECT                                  MESSAGE
4m41s       Normal    ScalingReplicaSet       deployment/load                         Scaled up replica set load-7f97579865 to 1
4m41s       Normal    SuccessfulCreate        replicaset/load-7f97579865              Created pod: load-7f97579865-mzdxd
4m41s       Normal    Injected                deployment/load                         Linkerd sidecar proxy injected
4m40s       Normal    Scheduled               pod/load-7f97579865-mzdxd               Successfully assigned test/load-7f97579865-mzdxd to k3d-k3s-default-agent-0
4m39s       Normal    ScalingReplicaSet       deployment/frontend                     Scaled up replica set frontend-6957977dc7 to 1
4m39s       Normal    Injected                deployment/frontend                     Linkerd sidecar proxy injected
4m39s       Normal    SuccessfulCreate        replicaset/frontend-6957977dc7          Created pod: frontend-6957977dc7-z8d4l
4m39s       Normal    ScalingReplicaSet       deployment/podinfo                      Scaled up replica set podinfo-7bfd46f477 to 1
4m38s       Normal    Scheduled               pod/frontend-6957977dc7-z8d4l           Successfully assigned test/frontend-6957977dc7-z8d4l to k3d-k3s-default-server-0
4m39s       Normal    SuccessfulCreate        replicaset/podinfo-7bfd46f477           Created pod: podinfo-7bfd46f477-q5pp9
4m38s       Normal    Scheduled               pod/podinfo-7bfd46f477-q5pp9            Successfully assigned test/podinfo-7bfd46f477-q5pp9 to k3d-k3s-default-agent-0
4m39s       Normal    Pulled                  pod/load-7f97579865-mzdxd               Container image "cr.l5d.io/linkerd/proxy-init:v1.5.3" already present on machine
4m37s       Normal    Pulled                  pod/frontend-6957977dc7-z8d4l           Container image "cr.l5d.io/linkerd/proxy-init:v1.5.3" already present on machine
4m37s       Normal    Pulled                  pod/podinfo-7bfd46f477-q5pp9            Container image "cr.l5d.io/linkerd/proxy-init:v1.5.3" already present on machine
4m37s       Normal    Created                 pod/load-7f97579865-mzdxd               Created container linkerd-init
4m37s       Normal    Started                 pod/load-7f97579865-mzdxd               Started container linkerd-init
4m36s       Normal    Pulled                  pod/load-7f97579865-mzdxd               Container image "cr.l5d.io/linkerd/proxy:stable-2.11.4" already present on machine
4m36s       Normal    Created                 pod/frontend-6957977dc7-z8d4l           Created container linkerd-init
4m36s       Normal    Created                 pod/podinfo-7bfd46f477-q5pp9            Created container linkerd-init
4m35s       Normal    Started                 pod/podinfo-7bfd46f477-q5pp9            Started container linkerd-init
4m35s       Normal    Started                 pod/frontend-6957977dc7-z8d4l           Started container linkerd-init
4m35s       Normal    Pulled                  pod/frontend-6957977dc7-z8d4l           Container image "cr.l5d.io/linkerd/proxy:stable-2.11.4" already present on machine
4m35s       Normal    Pulled                  pod/podinfo-7bfd46f477-q5pp9            Container image "cr.l5d.io/linkerd/proxy:stable-2.11.4" already present on machine
4m35s       Normal    Created                 pod/load-7f97579865-mzdxd               Created container linkerd-proxy
4m34s       Normal    IssuedLeafCertificate   serviceaccount/default                  issued certificate for default.test.serviceaccount.identity.linkerd.cluster.local until 2022-08-01 17:48:20 +0000 UTC: c5614f421dc7c674bcc1e6170fb7085b
4m34s       Normal    Started                 pod/load-7f97579865-mzdxd               Started container linkerd-proxy
4m34s       Normal    Pulling                 pod/load-7f97579865-mzdxd               Pulling image "buoyantio/slow_cooker:1.2.0"
4m33s       Normal    Created                 pod/frontend-6957977dc7-z8d4l           Created container linkerd-proxy
4m33s       Normal    Created                 pod/podinfo-7bfd46f477-q5pp9            Created container linkerd-proxy
4m33s       Normal    IssuedLeafCertificate   serviceaccount/default                  issued certificate for default.test.serviceaccount.identity.linkerd.cluster.local until 2022-08-01 17:48:21 +0000 UTC: 81e30c1c83add8b34f8b1092cb78c4a1
4m33s       Normal    IssuedLeafCertificate   serviceaccount/default                  issued certificate for default.test.serviceaccount.identity.linkerd.cluster.local until 2022-08-01 17:48:21 +0000 UTC: 28326288adb5d8e029cfbb70305e0938
4m33s       Normal    Started                 pod/frontend-6957977dc7-z8d4l           Started container linkerd-proxy
4m33s       Normal    Pulling                 pod/frontend-6957977dc7-z8d4l           Pulling image "nginx:alpine"
4m33s       Normal    Started                 pod/podinfo-7bfd46f477-q5pp9            Started container linkerd-proxy
4m33s       Normal    Pulling                 pod/podinfo-7bfd46f477-q5pp9            Pulling image "quay.io/stefanprodan/podinfo:1.7.0"
4m11s       Normal    Pulled                  pod/load-7f97579865-mzdxd               Successfully pulled image "buoyantio/slow_cooker:1.2.0" in 23.54068339s
4m7s        Normal    Pulled                  pod/podinfo-7bfd46f477-q5pp9            Successfully pulled image "quay.io/stefanprodan/podinfo:1.7.0" in 25.482798s
4m6s        Normal    Pulled                  pod/frontend-6957977dc7-z8d4l           Successfully pulled image "nginx:alpine" in 26.925333832s
3m47s       Normal    Created                 pod/frontend-6957977dc7-z8d4l           Created container nginx
3m47s       Normal    Created                 pod/podinfo-7bfd46f477-q5pp9            Created container podinfod
3m47s       Normal    Created                 pod/load-7f97579865-mzdxd               Created container slow-cooker
3m47s       Normal    Started                 pod/frontend-6957977dc7-z8d4l           Started container nginx
3m47s       Normal    Started                 pod/podinfo-7bfd46f477-q5pp9            Started container podinfod
3m47s       Normal    Started                 pod/load-7f97579865-mzdxd               Started container slow-cooker
2m47s       Warning   Synced                  canary/podinfo                          podinfo-primary.test not ready: waiting for rollout to finish: observed deployment generation less than desired generation
2m47s       Normal    ScalingReplicaSet       deployment/podinfo-primary              Scaled up replica set podinfo-primary-5cb494c64c to 1
2m47s       Normal    Injected                deployment/podinfo-primary              Linkerd sidecar proxy injected
2m47s       Normal    SuccessfulCreate        replicaset/podinfo-primary-5cb494c64c   Created pod: podinfo-primary-5cb494c64c-pnlv5
2m46s       Normal    Scheduled               pod/podinfo-primary-5cb494c64c-pnlv5    Successfully assigned test/podinfo-primary-5cb494c64c-pnlv5 to k3d-k3s-default-agent-1
2m45s       Normal    Pulled                  pod/podinfo-primary-5cb494c64c-pnlv5    Container image "cr.l5d.io/linkerd/proxy-init:v1.5.3" already present on machine
2m43s       Normal    Created                 pod/podinfo-primary-5cb494c64c-pnlv5    Created container linkerd-init
2m43s       Normal    Started                 pod/podinfo-primary-5cb494c64c-pnlv5    Started container linkerd-init
2m41s       Normal    Pulled                  pod/podinfo-primary-5cb494c64c-pnlv5    Container image "cr.l5d.io/linkerd/proxy:stable-2.11.4" already present on machine
2m40s       Normal    Created                 pod/podinfo-primary-5cb494c64c-pnlv5    Created container linkerd-proxy
2m40s       Normal    IssuedLeafCertificate   serviceaccount/default                  issued certificate for default.test.serviceaccount.identity.linkerd.cluster.local until 2022-08-01 17:50:14 +0000 UTC: eb34aca444e33c0fabbdccf90be7ad07
2m40s       Normal    Started                 pod/podinfo-primary-5cb494c64c-pnlv5    Started container linkerd-proxy
2m39s       Normal    Pulling                 pod/podinfo-primary-5cb494c64c-pnlv5    Pulling image "quay.io/stefanprodan/podinfo:1.7.0"
2m27s       Warning   Synced                  canary/podinfo                          podinfo-primary.test not ready: waiting for rollout to finish: 0 of 1 (readyThreshold 100%) updated replicas are available
2m24s       Normal    Pulled                  pod/podinfo-primary-5cb494c64c-pnlv5    Successfully pulled image "quay.io/stefanprodan/podinfo:1.7.0" in 15.460599449s
2m20s       Normal    Created                 pod/podinfo-primary-5cb494c64c-pnlv5    Created container podinfod
2m19s       Normal    Started                 pod/podinfo-primary-5cb494c64c-pnlv5    Started container podinfod
2m17s       Warning   Synced                  canary/podinfo                          Error checking metric providers: prometheus not avaiable: running query failed: request failed: Get "http://prometheus.linkerd-viz:9090/api/v1/query?query=vector%281%29": dial tcp: lookup prometheus.linkerd-viz on 10.43.0.10:53: no such host
2m17s       Normal    ScalingReplicaSet       deployment/podinfo                      Scaled down replica set podinfo-7bfd46f477 to 0
2m17s       Normal    SuccessfulDelete        replicaset/podinfo-7bfd46f477           Deleted pod: podinfo-7bfd46f477-q5pp9
2m17s       Normal    Killing                 pod/podinfo-7bfd46f477-q5pp9            Stopping container linkerd-proxy
2m17s       Normal    Killing                 pod/podinfo-7bfd46f477-q5pp9            Stopping container podinfod
2m17s       Normal    Synced                  canary/podinfo                          Initialization done! podinfo.test
37s         Normal    Synced                  canary/podinfo                          New revision detected! Scaling up podinfo.test
37s         Normal    ScalingReplicaSet       deployment/podinfo                      Scaled up replica set podinfo-69c49997fd to 1
37s         Normal    Injected                deployment/podinfo                      Linkerd sidecar proxy injected
37s         Normal    SuccessfulCreate        replicaset/podinfo-69c49997fd           Created pod: podinfo-69c49997fd-cvmbd
36s         Normal    Scheduled               pod/podinfo-69c49997fd-cvmbd            Successfully assigned test/podinfo-69c49997fd-cvmbd to k3d-k3s-default-agent-0
35s         Normal    Pulled                  pod/podinfo-69c49997fd-cvmbd            Container image "cr.l5d.io/linkerd/proxy-init:v1.5.3" already present on machine
32s         Normal    Created                 pod/podinfo-69c49997fd-cvmbd            Created container linkerd-init
32s         Normal    Started                 pod/podinfo-69c49997fd-cvmbd            Started container linkerd-init
31s         Normal    Pulled                  pod/podinfo-69c49997fd-cvmbd            Container image "cr.l5d.io/linkerd/proxy:stable-2.11.4" already present on machine
28s         Normal    Created                 pod/podinfo-69c49997fd-cvmbd            Created container linkerd-proxy
28s         Normal    IssuedLeafCertificate   serviceaccount/default                  issued certificate for default.test.serviceaccount.identity.linkerd.cluster.local until 2022-08-01 17:52:26 +0000 UTC: fddf9e5186660018db83514237d7f81a
28s         Normal    Started                 pod/podinfo-69c49997fd-cvmbd            Started container linkerd-proxy
28s         Normal    Pulling                 pod/podinfo-69c49997fd-cvmbd            Pulling image "quay.io/stefanprodan/podinfo:1.7.1"
17s         Warning   Synced                  canary/podinfo                          canary deployment podinfo.test not ready: waiting for rollout to finish: 0 of 1 (readyThreshold 100%) updated replicas are available
12s         Normal    Pulled                  pod/podinfo-69c49997fd-cvmbd            Successfully pulled image "quay.io/stefanprodan/podinfo:1.7.1" in 15.849870828s
10s         Normal    Created                 pod/podinfo-69c49997fd-cvmbd            Created container podinfod
10s         Normal    Started                 pod/podinfo-69c49997fd-cvmbd            Started container podinfod
7s          Normal    Synced                  canary/podinfo                          Starting canary analysis for podinfo.test
7s          Normal    Synced                  canary/podinfo                          Advance podinfo.test canary weight 10

teemu@teemu-ideapad:~$ kubectl -n test get canary
NAME      STATUS      WEIGHT   LASTTRANSITIONTIME
podinfo   Succeeded   0        2022-07-31T17:55:11Z

teemu@teemu-ideapad:~$ kubectl -n test get trafficsplit podinfo -o yaml
apiVersion: split.smi-spec.io/v1alpha2
kind: TrafficSplit
metadata:
  creationTimestamp: "2022-07-31T17:50:17Z"
  generation: 2
  name: podinfo
  namespace: test
  ownerReferences:
  - apiVersion: flagger.app/v1beta1
    blockOwnerDeletion: true
    controller: true
    kind: Canary
    name: podinfo
    uid: 3be0183e-ae8a-464b-bc21-6c6fe5776c81
  resourceVersion: "12306"
  uid: 0e069dfc-e0be-447f-8668-f4b12cb3d581
spec:
  backends:
  - service: podinfo-canary
    weight: "10"
  - service: podinfo-primary
    weight: "90"
  service: podinfo

teemu@teemu-ideapad:~$ linkerd viz -n test stat deploy --from deploy/load
NAME              MESHED   SUCCESS       RPS   LATENCY_P50   LATENCY_P95   LATENCY_P99   TCP_CONN
podinfo              0/0         -         -             -             -             -          -
podinfo-primary      1/1   100.00%   10.0rps           2ms           5ms           5ms          1

teemu@teemu-ideapad:~$  linkerd viz dashboard
Linkerd dashboard available at:
http://localhost:50750
Grafana dashboard available at:
http://localhost:50750/grafana
Opening Linkerd dashboard in the default browser


Kakubectl -n test port-forward svc/frontend 8080
Forwarding from 127.0.0.1:8080 -> 8080
Forwarding from [::1]:8080 -> 8080
Handling connection for 8080
Handling connection for 8080
Handling connection for 8080
Handling connection for 8080
Handling connection for 8080

teemu@teemu-ideapad:~$ kubectl delete -k github.com/fluxcd/flagger/kustomize/linkerd && kubectl delete ns test
customresourcedefinition.apiextensions.k8s.io "alertproviders.flagger.app" deleted
customresourcedefinition.apiextensions.k8s.io "canaries.flagger.app" deleted
customresourcedefinition.apiextensions.k8s.io "metrictemplates.flagger.app" deleted
serviceaccount "flagger" deleted
clusterrole.rbac.authorization.k8s.io "flagger" deleted
clusterrolebinding.rbac.authorization.k8s.io "flagger" deleted
deployment.apps "flagger" deleted
namespace "test" deleted